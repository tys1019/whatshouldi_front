"use strict";function loginController(a,b,c,d,e){var f=this;f.$modalInstance=c,f.hasErrors=!1,f.login=function(a){b.login(a).success(function(a){f.$modalInstance.close(a),f.credentials={},d.getPlaylist(b.user.playlist_id)}).error(function(){f.hasErrors=!0})}}function navbarController(a,b,c){var d=this;d.user=a.user,d.logout=function(){a.logout().then(function(){c.path("/")})},d.search=function(){b.search(d.search_params).then(function(a){d.$modalInstance.close(a)})},d.isLoggedIn=function(){return a.isAuthenticated()}}function signUpController(a,b,c,d,e){var f=this;f.$modalInstance=c,f.signUp=function(a){b.signUp(a).success(function(a){f.$modalInstance.close(a),f.credentials={},d.getPlaylistByUser(b.user)})}}function movieController(a,b,c){var d=this;d.movies=a.movies,a.getMovies(),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function bookController(a,b,c){var d=this;d.books=a.books,$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()}),$(window).resize(a.fixHeights),a.getBooks()}function searchController(a,b,c){var d=this;d.results=a.results,d.search_params={media_type:"Movie"},c&&(d.$modalInstance=c),d.search=function(){"Books"===d.search_params.media_type?a.bookSearch(d.search_params.search_query).then(function(){d.$modalInstance.close()}):a.search(d.search_params).then(function(a){d.$modalInstance.close(a)})},$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function searchResultsController(a,b){var c=this;c.results=a.results,$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function tvSearchResultsController(a,b){var c=this;c.results=a.tvResults,$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function bookSearchResultsController(a,b){var c=this;c.results=a.bookResults,$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function movieDetailsController(a,b,c,d,e,f,g){var h=this;h.movie=a.movie,h.isAuthenticated=function(){return f.isAuthenticated()},h.updatePlaylist=function(){var a=JSON.parse(d.localStorage.getItem("ga-user"));e.updatePlaylist(a,this.movie)},h.isInPlaylist=function(){return f.isAuthenticated()&&e.isInPlaylist(h.movie)?!0:!1},h.hasStreamingLinks=function(){return!h.movie.title||0===h.movie.subscription_web_sources.length&&!h.movie.netflixLink?!1:!0},h.hasPurchaseLinks=function(){return h.movie.title&&0!==h.movie.purchase_web_sources.length?!0:!1},h.hasFreeLinks=function(){return h.movie.title&&0!==h.movie.free_web_sources.length?!0:!1},h.getMovieRatings=function(){h.movie.rt_ratings||a.getMovieRatings(h.movie.rottentomatoes_id)},h.getMovieReviews=function(){h.movie.rt_reviews||a.getMovieReviews(h.movie.rottentomatoes_id)},h.getNetflixLink=function(){a.getNetflixLink(h.movie)},h.getRelatedMovies=function(){h.movie.related||a.getRelatedMovies(h.movie.imdb_id)},a.getMovieDetails(c.guideboxId).then(h.getMovieRatings).then(h.getMovieReviews).then(h.getNetflixLink).then(h.getRelatedMovies),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function modalController(a,b){var c=this;c.openLogin=function(){a.open({templateUrl:"views/login-form.html",controller:"LoginController as loginController"})},c.openSignUp=function(){a.open({templateUrl:"views/sign-up-form.html",controller:"SignUpController as signUpController"})},c.openSearch=function(){a.open({templateUrl:"views/search-form.html",controller:"SearchController as searchController"})},c.openEpisode=function(c){b.setEpisode(c);a.open({templateUrl:"views/episode-details.html",controller:"EpisodeController as episodeController"})}}function playlistController(a,b,c,d){var e=this;e.playlist=a.playlist,a.getPlaylist(c.playlistId),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function tvDetailsController(a,b,c,d,e,f,g){var h=this;h.tvShow=a.tvShow,h.isAuthenticated=function(){return f.isAuthenticated()},h.updatePlaylist=function(){var a=JSON.parse(d.localStorage.getItem("ga-user"));e.updateShowPlaylist(a,this.tvShow)},h.isInPlaylist=function(){return f.isAuthenticated()&&e.isInTVPlaylist(h.tvShow)?!0:!1},h.getOrToggleEpisodes=function(b){h.tvShow.seasons[b-1].episodes?h.tvShow.seasons[b-1].displayEpisodes=!h.tvShow.seasons[b-1].displayEpisodes:(a.getEpisodes(h.tvShow.guidebox_id,b),h.tvShow.seasons[b-1].displayEpisodes=!0)},h.getSeasons=function(){h.tvShow.seasons||a.getSeasons(h.tvShow.guidebox_id)},h.getRelatedShows=function(){h.tvShow.related||a.getRelatedShows(h.tvShow.imdb_id)},a.getTvShowDetails(c.guideboxId).then(h.getSeasons).then(h.getRelatedShows),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function bookDetailsController(a,b,c){var d=this;d.book=a.book,a.getBookDetails(c.googleId),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function tvController(a,b,c){var d=this;d.shows=a.shows,a.getShows(),$(".main-content").on("click",function(){$("#navbar-collapse-1").hasClass("in")&&$(".navbar-toggle").click()})}function episodeController(a,b,c,d,e){var f=this;f.$modalInstance=c,f.parseJSON=function(){f.episode.purchase_web_sources=JSON.parse(f.episode.purchase_web_sources),f.episode.free_web_sources=JSON.parse(f.episode.free_web_sources),f.episode.subscription_web_sources=JSON.parse(f.episode.subscription_web_sources),f.episode.tv_everywhere_web_sources=JSON.parse(f.episode.tv_everywhere_web_sources)},f.closeModal=function(){f.$modalInstance.close()},f.episode=d.episode,d.getNetflixLink(),f.parseJSON()}angular.module("whatshouldiApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","MainController","MainDirective","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MovieController",controllerAs:"movieController"}).when("/movie/:guideboxId",{templateUrl:"views/movie-details.html",controller:"MovieDetailsController",controllerAs:"movieDetailsController"}).when("/playlists/:playlistId",{templateUrl:"views/playlist.html",controller:"PlaylistController",controllerAs:"playlistController"}).when("/search",{templateUrl:"views/search-results.html",controller:"SearchResultsController",controllerAs:"searchResultsController"}).when("/search/tv",{templateUrl:"views/tv-search-results.html",controller:"TvSearchResultsController",controllerAs:"tvSearchResultsController"}).when("/search/books",{templateUrl:"views/book-search-results.html",controller:"BookSearchResultsController",controllerAs:"bookSearchResultsController"}).when("/tv/:guideboxId",{templateUrl:"views/tv-details.html",controller:"TvDetailsController",controllerAs:"tvDetailsController"}).when("/book/:googleId",{templateUrl:"views/book-details.html",controller:"BookDetailsController",controllerAs:"bookDetailsController"}).otherwise({redirectTo:"/"})}]).filter("trustUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).run(["MovieFactory","AuthFactory","PlaylistFactory","$rootScope","$timeout","$window",function(a,b,c,d,e,f){b.user.playlist_id&&c.getPlaylist(b.user.playlist_id)}]),jQuery(document).ready(function(a){function b(){c(a(".cd-headline.letters").find("b")),d(a(".cd-headline"))}function c(b){b.each(function(){var b=a(this),c=b.text().split(""),d=b.hasClass("is-visible");for(i in c)c[i]=d?'<i class="in">'+c[i]+"</i>":"<i>"+c[i]+"</i>";var e=c.join("");b.html(e).css("opacity",1)})}function d(b){var c=j;b.each(function(){var b=a(this);if(b.hasClass("loading-bar"))c=k,setTimeout(function(){b.find(".cd-words-wrapper").addClass("is-loading")},l);else if(b.hasClass("clip")){var d=b.find(".cd-words-wrapper"),f=d.width()+10;d.css("width",f)}else if(!b.hasClass("type")){var g=b.find(".cd-words-wrapper b"),h=0;g.each(function(){var b=a(this).width();b>h&&(h=b)}),b.find(".cd-words-wrapper").css("width",h)}setTimeout(function(){e(b.find(".is-visible").eq(0))},c)})}function e(a){var b=h(a);if(a.parents(".cd-headline").hasClass("type")){var c=a.parent(".cd-words-wrapper");c.addClass("selected").removeClass("waiting"),setTimeout(function(){c.removeClass("selected"),a.removeClass("is-visible").addClass("is-hidden").children("i").removeClass("in").addClass("out")},n),setTimeout(function(){f(b,m)},o)}}function f(a,b){a.parents(".cd-headline").hasClass("type")&&(g(a.find("i").eq(0),a,!1,b),a.addClass("is-visible").removeClass("is-hidden"))}function g(a,b,c,d){a.addClass("in").removeClass("out"),a.is(":last-child")?(b.parents(".cd-headline").hasClass("type")&&setTimeout(function(){b.parents(".cd-words-wrapper").addClass("waiting")},200),c||setTimeout(function(){e(b)},j)):setTimeout(function(){g(a.next(),b,c,d)},d)}function h(a){return a.is(":last-child")?a.parent().children().eq(0):a.next()}var j=2500,k=3800,l=k-3e3,m=350,n=1700,o=n+800;b()}),angular.module("whatshouldiApp").constant("ServerUrl","https://whatshouldi-api.herokuapp.com"),angular.module("whatshouldiApp").factory("AuthFactory",["$http","$window","ServerUrl","PlaylistFactory",function(a,b,c){var d=JSON.parse(b.localStorage.getItem("ga-user"))||{},e=function(b,e){return a.post(c+"/login",b).success(function(a){i(a),angular.copy(a,d)})},f=function(){return a.get(c+"/logout").success(function(){b.localStorage.removeItem("ga-user"),b.localStorage.removeItem("ga-playlist"),d={}})},g=function(b){return a.post(c+"/sign-up",b).success(function(a){i(a)})},h=function(){var a=JSON.parse(b.localStorage.getItem("ga-user"));return a?!!a.token:!1},i=function(c){b.localStorage.setItem("ga-user",JSON.stringify(c)),a.defaults.headers.common.Authorization="Token token="+c.token};return{user:d,login:e,signUp:g,logout:f,isAuthenticated:h}}]),angular.module("whatshouldiApp").factory("MovieFactory",["$http","$window","ServerUrl",function(a,b,c){var d=[],e={},f=function(){angular.copy([],d),a.get(c+"/movies").success(function(a){angular.copy(a,d)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},g=function(b){return angular.copy({},e),a.post(c+"/search",{guidebox_id:b,media_type:"Movie"}).success(function(a){angular.copy(a.movie,e),l()}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},h=function(b){return a.post(c+"/search",{rottentomatoes_id:b,search_type:"rt_ratings"}).success(function(a){e.rt_ratings=JSON.parse(a.movie.rt_ratings)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},i=function(b){return a.post(c+"/search",{rottentomatoes_id:b,search_type:"rt_reviews"}).success(function(a){e.rt_reviews=JSON.parse(a.movie.rt_reviews)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},j=function(b){return a.post(c+"/search",{imdb_id:b,search_type:"related_movies"}).success(function(a){e.related=JSON.parse(a.results)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},k=function(b){return a.get("http://netflixroulette.net/api/api.php?title="+b.title).success(function(a){b.netflixLink="http://www.netflix.com/WiMovie/"+a.show_id}).error(function(a,c,d,e){b.netflixLink="http://dvd.netflix.com/Search?v1="+b.title+"&ac_abs_posn=-1&fcld=true&ac_rel_posn=-1&ac_category_type=none"})},l=function(){e.rt_ratings&&(e.rt_ratings=JSON.parse(e.rt_ratings)),e.rt_reviews&&(e.rt_reviews=JSON.parse(e.rt_reviews)),e.related&&(e.related=JSON.parse(e.related)),e.purchase_web_sources=JSON.parse(e.purchase_web_sources),e.subscription_web_sources=JSON.parse(e.subscription_web_sources),e.free_web_sources=JSON.parse(e.free_web_sources)};return{movies:d,movie:e,getMovies:f,getMovieDetails:g,getMovieRatings:h,getMovieReviews:i,getNetflixLink:k,getRelatedMovies:j}}]),angular.module("whatshouldiApp").factory("SearchFactory",["$http","$window","ServerUrl","$location",function(a,b,c,d){var e=[],f=[],g=[],h=function(b){return a.post(c+"/search",b).success(function(a){"TV"===a.search_params.media_type?(angular.copy(a.results,f),d.path("/search/tv")):(angular.copy(a.results,e),d.path("/search/"))}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},i=function(b){return a.get("https://www.googleapis.com/books/v1/volumes?q="+b).success(function(a){angular.copy(a.items,g),d.path("/search/books")}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})};return{results:e,search:h,bookSearch:i,bookResults:g,tvResults:f}}]),angular.module("whatshouldiApp").factory("PlaylistFactory",["$http","$window","ServerUrl","$routeParams","MovieFactory",function(a,b,c,d,e){var f=[],g=JSON.parse(b.localStorage.getItem("ga-playlist"))||{},h=(e.movie,function(b){a.get(c+"/playlists/"+b).success(function(a){angular.copy(a,g),n(a)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})}),i=function(b){a.get(c+"/users/"+b.id).success(function(a){angular.copy(a,g),n(a)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},j=function(b,d){var e={user:b,movie:d};a.put(c+"/playlists/"+b.playlist_id,e).success(function(a){angular.copy(a,g)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},k=function(b,d){var e={user:b,show:{id:d.id}};a.put(c+"/playlists/"+b.playlist_id,e).success(function(a){angular.copy(a,g)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},l=function(a){return g.movies?g.movies.some(function(b){return b.guidebox_id===a.guidebox_id}):!1},m=function(a){return g.shows_simple?g.shows_simple.some(function(b){return b.guidebox_id===a.guidebox_id}):!1},n=function(a){b.localStorage.setItem("ga-playlist",JSON.stringify(a))};return{playlists:f,playlist:g,getPlaylist:h,updatePlaylist:j,updateShowPlaylist:k,isInTVPlaylist:m,isInPlaylist:l,getPlaylistByUser:i}}]),angular.module("whatshouldiApp").factory("TvFactory",["$http","$window","ServerUrl",function(a,b,c){var d=[],e={},f={},g=function(){angular.copy([],d),a.get(c+"/shows").success(function(a){angular.copy(a,d)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},h=function(b){return angular.copy({},e),a.post(c+"/search",{guidebox_id:b,media_type:"TV"}).success(function(a){angular.copy(a.results,e),e.netflixLink="http://dvd.netflix.com/Search?v1="+e.title+"&ac_abs_posn=-1&fcld=true&ac_rel_posn=-1&ac_category_type=none",n()}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},i=function(b,d){var f={guidebox_id:b,search_type:"episodes",season:d};return a.post(c+"/search",f).success(function(a){var b=JSON.parse(a.results),c=a.search_params.season-1;e.seasons[c].episodes=b.reverse()}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},j=function(b){return a.post(c+"/search",{guidebox_id:b,search_type:"seasons"}).success(function(a){e.seasons=JSON.parse(a.results)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},k=function(a){angular.copy(a,f)},l=function(){return a.get("http://netflixroulette.net/api/api.php?title="+e.title).success(function(a){f.netflixLink="http://www.netflix.com/WiMovie/"+a.show_id}).error(function(a,b,c,d){f.netflixLink="http://dvd.netflix.com/Search?v1="+e.title+"&ac_abs_posn=-1&fcld=true&ac_rel_posn=-1&ac_category_type=none"})},m=function(b){var d={imdb_id:b,search_type:"related_shows"};return a.post(c+"/search",d).success(function(a){e.related=JSON.parse(a.results)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},n=function(){e.episodes&&(e.episodes=JSON.parse(e.episodes)),e.seasons&&(e.seasons=JSON.parse(e.seasons)),e.related&&(e.related=JSON.parse(e.related))};return{tvShow:e,shows:d,getShows:g,episode:f,setEpisode:k,getEpisodes:i,getTvShowDetails:h,getSeasons:j,getNetflixLink:l,getRelatedShows:m}}]),angular.module("whatshouldiApp").factory("BookFactory",["$http","$window","ServerUrl","$location",function(a,b,c,d){var e={},f=[],g=function(b){return angular.copy({},e),a.get("https://www.googleapis.com/books/v1/volumes/"+b).success(function(a){angular.copy(a,e),i()}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},h=function(){return angular.copy([],f),a.get(c+"/books").success(function(a){angular.copy(a,f),setTimeout(j,1e3)}).error(function(a,b,c,d){console.log("Youre doing it wrong "+a,b,c,d)})},i=function(){return a.post(c+"/books",{google_id:e.id,title:e.volumeInfo.title,thumbnail:e.volumeInfo.imageLinks.small||e.volumeInfo.imageLinks.thumbnail})},j=function(){var a=$(".main-page-poster:first"),b=$(".main-page-book");b.each(function(b,c){$(c).height(a.height())})};return{book:e,books:f,getBookDetails:g,getBooks:h,fixHeights:j}}]),angular.module("MainController",[]),angular.module("MainController").controller("LoginController",loginController),loginController.$inject=["$location","AuthFactory","$modalInstance","PlaylistFactory","$route"],angular.module("MainController").controller("NavbarController",navbarController),navbarController.$inject=["AuthFactory","SearchFactory","$location"],angular.module("MainController").controller("SignUpController",signUpController),signUpController.$inject=["$location","AuthFactory","$modalInstance","PlaylistFactory","$route"],angular.module("MainController").controller("MovieController",movieController),movieController.$inject=["MovieFactory","$location","$routeParams"],angular.module("MainController").controller("BookController",bookController),bookController.$inject=["BookFactory","$location","$routeParams"],angular.module("MainController").controller("SearchController",searchController),searchController.$inject=["SearchFactory","$location","$modalInstance"],angular.module("MainController").controller("SearchResultsController",searchResultsController),searchResultsController.$inject=["SearchFactory","$location"],angular.module("MainController").controller("TvSearchResultsController",tvSearchResultsController),tvSearchResultsController.$inject=["SearchFactory","$location"],angular.module("MainController").controller("BookSearchResultsController",bookSearchResultsController),bookSearchResultsController.$inject=["SearchFactory","$location"],angular.module("MainController").controller("MovieDetailsController",movieDetailsController),movieDetailsController.$inject=["MovieFactory","$location","$routeParams","$window","PlaylistFactory","AuthFactory","$scope"],angular.module("MainController").controller("ModalController",modalController),modalController.$inject=["$modal","TvFactory"],angular.module("MainController").controller("PlaylistController",playlistController),playlistController.$inject=["PlaylistFactory","$location","$routeParams"],angular.module("MainController").controller("TvDetailsController",tvDetailsController),tvDetailsController.$inject=["TvFactory","$location","$routeParams","$window","PlaylistFactory","AuthFactory","$scope"],angular.module("MainController").controller("BookDetailsController",bookDetailsController),bookDetailsController.$inject=["BookFactory","$location","$routeParams"],angular.module("MainController").controller("TvController",tvController),tvController.$inject=["TvFactory","$location","$routeParams"],angular.module("MainController").controller("EpisodeController",episodeController),episodeController.$inject=["$location","AuthFactory","$modalInstance","TvFactory","$route"],angular.module("MainDirective",[]),angular.module("MainDirective").directive("loginForm",[function(){return{restrict:"E",templateUrl:"views/login-form.html",controller:"LoginController",controllerAs:"loginController",bindToController:!0}}]),angular.module("MainDirective").directive("signUpForm",[function(){return{restrict:"E",templateUrl:"views/sign-up-form.html",controller:"SignUpController",controllerAs:"signUpController",bindToController:!0}}]),angular.module("MainDirective").directive("dtSearch",[function(){return{restrict:"EA",templateUrl:"views/search-results.html",controller:"SearchController",controllerAs:"searchController",bindToController:!0}}]),angular.module("MainDirective").directive("selectpicker",["$parse",function(a){return{restrict:"A",link:function(b,c,d){c.selectpicker(a(d.selectpicker)()),c.selectpicker("refresh"),b.$watch(d.ngModel,function(a,e){b.$parent[d.ngModel]=a,b.$evalAsync(function(){(!d.ngOptions||/track by/.test(d.ngOptions))&&c.val(a),c.selectpicker("refresh")})}),b.$on("$destroy",function(){b.$evalAsync(function(){c.selectpicker("destroy")})})}}}]);